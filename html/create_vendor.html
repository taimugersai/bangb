<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../js/mui.min.js"></script>
		<script src="../js/common.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/common.css" />
		<link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />
		<style type="text/css">
			.content {
				margin-top: 0px;
				padding:0;
			}
		
			
			.mui-input-row {
				background-color: #fff;
				font-family: 0.28rem;
			}
			.area {
				margin: 20px auto 0px auto;
			}
			
			.mui-input-group:first-child {
				margin-top: 20px;
			}
			
			.mui-input-group label {
				width: 30%;
			}
			
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				
			}
			
			.mui-checkbox input[type=checkbox],
			.mui-radio input[type=radio] {
				top: 6px;
				
			}
			
			.mui-content-padded {
				margin-top: 25px;
			}
			
			.mui-btn {
				padding: 10px;
			}
			
			.yzm {
				position: absolute;
				height: 99%;
				padding: 10px;
				right: 0px;
				border: 1px solid #FF5556;
				color: #FF5556;
			}
			body {
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 0px;
				background: #fdfdfd;
			}
		
			
			.mui-input-group {
				margin-top: -1.23rem;
				margin-left: 0.21rem;
				width:7.08rem;
				height: auto;
			}

			.oauth-area {
				position: absolute;
				bottom: 20px;
				left: 0px;
				text-align: center;
				width: 100%;
				padding: 0px;
				margin: 0px;
			}
			
			.oauth-area .oauth-btn {
				display: inline-block;
				width: 50px;
				height: 50px;
				background-size: 30px 30px;
				background-position: center center;
				background-repeat: no-repeat;
				margin: 0px 20px;
				/*-webkit-filter: grayscale(100%); */
				border: solid 1px #ddd;
				border-radius: 25px;
			}
			
			.oauth-area .oauth-btn:active {
				border: solid 1px #aaa;
			}
			
			.oauth-area .oauth-btn.disabled {
				background-color: #ddd;
			}
			
			#logo {
				position: relative;
				width: 128px;
				height: 128px;
				margin: auto;
				margin-top: 25px;
				;
			}
			.content {
			position: absolute;
			width: 100%;
			height: 100vh;
			margin: 0 auto;
			background: #fdfdfd;
		}
		.logo_box{
			width: 7.5rem;
			height: 5.9rem;
			background: #FF5556;
			padding-top: 2.13rem;
		}
		.logo_box div{
			width: 1.83rem;
			height: 1.83rem;
			margin-left: 2.81rem;
			background: #FFFFFF;
			background-image: url(../images/logo.png);
			background-size: 80% 80%; 
			background-position:center;
			background-repeat:no-repeat;
			border-radius: 6px;
		}
		.mui-input-row{
			width: 6.44rem;
			height: 0.92rem!important;
			background: #f8f8f8!important;
			margin-left: 0.32rem;
			margin-top: 0.11rem;
		}
		.iconfont{
			position: absolute;
			top:0.25rem;
			left: 0.5rem;
		}
		.mui-input{
			font-size: 0.28rem;
			border-bottom: 0!important;
			padding-top: 0.4rem!important;
			padding-bottom: 0.3rem!important;
			
		}
		.mui-input-group .mui-input-row:after{
			height: 0!important;
		}
		.mui-btn{
			width: 6.45rem;
			margin-left: 0.31rem;
			margin-top: 0.47rem;
			
			background: #ff5556;
			border: 1px solid #ff5556;
			
		}
		.mui-icon-eye:before{
			content: '';
		}
		.mui-input-row textarea{
			font-size: 0.28rem;
			padding-top: 0.3rem;
		}
		.head_tag{
			float:left;
			font-size: 0.28rem;
			text-align: left;
			margin-left: 0.6rem;
			margin-top: 0.16rem;
			width: 0.77rem!important;
		}
		.head_box{
			display: inline-block;
			float:left;
			margin-left: 0.38rem;
			margin-top: 0.16rem;
			width: 1.4rem;
			height: 1.4rem;
			background: #f8f8f8;
			background-image: url(../images/add.png);
			background-size: 100% 100%; 
			background-position:center;
			background-repeat:no-repeat;
		}
		</style>
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
	</head>

	<body>
		<div class="content">
			<div class="logo_box">
				<div></div>
			</div>
			<form id='login-form' class="mui-input-group">
				<div style="height: 0.15rem;"></div>
				<div class="mui-input-row" style="margin-top: 0;">
					<!--<label>公司名称</label>-->
					<textarea id="name" rows="1" placeholder="公司名称..." ></textarea>
				</div>
				<div class="mui-input-row">
					<!--<label>联系人</label>-->
					<input id="comporation" type="text" class="mui-input-clear mui-input" placeholder="请输入联系人...">
				</div>
				<div class="mui-input-row">
					<!--<label>联系电话</label>-->
					<input id="mobile" type="text" class="mui-input-clear mui-input" placeholder="联系电话...">
				</div>
				<div class="mui-input-row">
					<!--<label>公司地址</label>-->
					<textarea id="address" rows="1" placeholder="公司地址..." ></textarea>
				</div>
				<div class="mui-input-row">
					<!--<label>公司简介</label>-->
					<textarea id="introduce" rows="3" placeholder="公司简介..."></textarea>
				</div>
				<label class='head_tag'>头像:</label>
				<div id="file" class="head_box"></div>
				<div class="clear"></div>
				<a><button type="button" class="mui-btn mui-btn-blue mui-btn-block" id="confirm">确认</button></a>
			</form>
			
		</div>
		<script src="../js/app.js"></script>
		<script>
            window.addEventListener('close',function(){
                plus.webview.currentWebview().close();
            });
			var setting, vendor;
			(function($, doc) {
				$.init();
                $.back = function() {
                    var regPage = plus.webview.getWebviewById('reg');
                    $.fire(regPage, 'close');
                    plus.webview.currentWebview().close();
                };
				$.back = function() {
						mui.openWindow({
							url: 'login.html',
							id: 'login'
						});
					};
				$.plusReady(function() {
                    document.getElementById("file").addEventListener('tap',function () {
                        var btnArray = [{title:"拍照"},{title:"相册选取"}];
                        plus.nativeUI.actionSheet( {
                            title:"选择照片",
                            cancel:"取消",
                            buttons:btnArray
                        }, function(e){
                            var index = e.index;
                            switch (index){
                                case 0:

                                    break;
                                case 1:
                                    appendByCamera();
                                    break;
                                case 2:
                                    appendByGallery();
                                    break;
                            }

                        } );
                    });
					setting = plus.webview.getWebviewById('tab-webview-subpage-setting.html');
					var name = doc.getElementById('name');
					var comporation = doc.getElementById('comporation');
					var mobile = doc.getElementById('mobile');
					var address = doc.getElementById('address');
					var introduce = doc.getElementById('introduce');
					var confirm = doc.getElementById('confirm');
					confirm.addEventListener('tap', function(event) {
						var user = {
							name: name.value,
							comporation: comporation.value,
							mobile: mobile.value,
							address: address.value,
							introduce: introduce.value
						};

						app.updateVendor(user, function(err) {
							if(err) {
								plus.nativeUI.toast(err);
								return;
							}

							upload();

						});
					});
					var user = JSON.parse(localStorage.getItem('user'));
					if(localStorage.getItem('user')!= null) {
						name.value = user.name;
						comporation.value = user.comporation;
						mobile.value = user.mobile;
						address.value = user.address;
						introduce.value = user.introduce;
					}
				});
			})(mui, document);
			var server = "http://47.92.90.21/api/vendor/avatar";
			var file;
			// 上传文件
			function upload() {
				if(file == null) {
					plus.nativeUI.toast('完善成功');
                    mui.openWindow({
							url: 'tab-webview-main.html',
							id: 'vendor',
							show: {
								aniShow: 'pop-in'
							}
						});
                    var regPage = plus.webview.getWebviewById('reg');
                   mui.fire(regPage, 'close');
					return;
				}
				var wt = plus.nativeUI.showWaiting();
				var task = plus.uploader.createUpload(server, {
						method: "POST"
					},
					function(t, status) { //上传完成
						if(status == 200) {
							plus.nativeUI.toast('完善成功');
							localStorage.setItem('user', JSON.stringify(JSON.parse(t.responseText).data));
							wt.close();
									mui.openWindow({
									url: 'tab-webview-main.html',
									id: 'vendor',
									show: {
										aniShow: 'pop-in'
									}
								});
                            var regPage = plus.webview.getWebviewById('reg');
                            mui.fire(regPage, 'close');
						} else {
							plus.nativeUI.toast('上传失败');
							wt.close();
						}
					}
				);
				var token = localStorage.getItem('token');
				task.setRequestHeader("Authorization", 'bearer' + token);
				task.addData("client", "HelloH5+");
				task.addData("uid", getUid());
				task.addFile(file.path, {
					key: file.name
				});

				task.start();
			}
			// 拍照添加文件
			function appendByCamera() {
				plus.camera.getCamera().captureImage(function(p) {
					appendFile(p);
				});
			}
			// 从相册添加文件
			function appendByGallery() {
				plus.gallery.pick(function(p) {
					appendFile(p);
				});
			}

			function appendFile(p) {
				var li = document.getElementById("file");
				var n = p.substr(p.lastIndexOf('/') + 1);
				//li.innerText = n;
				file = {
					name: "avatar",
					path: p
				};
				li.style.backgroundImage = "url("+p+")";
			}
			// 产生一个随机数
			function getUid() {
				return Math.floor(Math.random() * 100000000 + 10000000).toString();
			}
		</script>
	</body>

</html>